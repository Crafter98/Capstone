<!DOCTYPE html>
<html>
    <head>
        <meta charset = "utf-8">
        <title>오늘의 키워드</title>
        <link href="test.css?a" type="text/css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"
            type="text/javascript"></script>

        <script>
            // 키워드 클릭했을 때 색 바꾸고 결과 띄우는 함수
            function ClickKeyword(target){
                $("#keywordTable td").css("border", "0")
                var keyword = $(target).text()
                $(target).css("border", "2px solid red")

                dateChange = $("#currentDate").text().replace(/-/gi, '.')
                $.ajax({
                    url: "relatedWords.php",
                    type: "post",
                    data: {date : dateChange,
                        keyword : keyword },
                    }).done(function(data) {
                        $('#relatedWordsTable').html(data);
                        $(".grid.result2").css("visibility", "visible")
                });
            }

            // 날짜를 string으로 바꿔주는 함수
            function dateToString(curDate){
                var year = curDate.getFullYear();
                var month = curDate.getMonth()+1;
                var date = curDate.getDate();

                month = month >=10 ? month : "0" + month;
                date  = date  >= 10 ? date : "0" + date;
                return today = "" + year + "-" + month + "-" + date;
            }
            
            // 날짜 변경 버튼 활성화 / 비활성화 함수
            function btnActive(){ $("#tom").removeAttr("disabled");}
            function btnInActive(){ $("#tom").attr("disabled", "disabled");}

            function toEnglish(str){
                if(str == "정치"){
                    return "#politic"
                }
                else if(str == "경제"){
                    return "#economy"
                }
                else if(str == "사회"){
                    return "#social"
                }
                else if(str == "생활/문화"){
                    return "#lifeCulture"
                }
                else if(str == "세계"){
                    return "#global"
                }
                else if(str == "IT/과학"){
                    return "#science"
                }
            }
            
            // 카테고리 버튼 활성화/비활성화 색 변경 함수
            function activateButton(btn){
                btn = toEnglish(btn)
                $(btn).css("background-color", "#F4B183")
            }
            function inactivateButton(btn){
                btn = toEnglish(btn)
                $(btn).css("background-color", "#8497B0")
            }     
        </script>

        <script>
            $(document).ready(function(){
                // 오늘 하루 전으로 기본 세팅
                var now = new Date();
                now.setDate(now.getDate()-1);
                var now = dateToString(now);
                var cur = now; // now = 오늘 날짜, cur = 현재 선택된 날짜
                var section = '정치';

                // 달력 선택도 하루 전날로 세팅
                var selectedDate = document.querySelector('input[type="date"]');
                // selectedDate.value = now;
                selectedDate.max = now;
                
                cur = "2021-09-02"

                $("#currentDate").text(cur);
                // btnInActive();
                showKeywords();
                activateButton(section)

                // $(".grid.result2").css("visibility", "hidden")


                // 달력에서 날짜 선택했을 때 해당 날짜로 변경하기
                selectedDate.addEventListener('change', function(){
                    cur = selectedDate.value;
                    $("#currentDate").text(cur);
                    showKeywords();

                    if(cur != now){ btnActive();}
                    else if(cur == now){ btnInActive();}
                });

                // < 버튼 클릭했을 때 하루 전날로 세팅
                $("#yes").click(function(){
                    cur = new Date(cur);
                    cur.setDate(cur.getDate() - 1);
                    cur = dateToString(cur);

                    if(cur != now){
                        btnActive();
                    }
                        
                    // selectedDate.value = cur;
                    $("#currentDate").text(cur);
                    showKeywords();
                });

                // > 버튼 클릭했을 때 하루 다음날로 세팅
                $("#tom").click(function(){
                    cur = new Date(cur);
                    cur.setDate(cur.getDate() + 1);
                    cur = dateToString(cur);

                    if(cur == now){
                        btnInActive();
                    }
                        
                    // selectedDate.value = cur;
                    $("#currentDate").text(cur);
                    showKeywords();
                });

                // php와 연동해서 그 날의 키워드 보여주는 함수
                function showKeywords(){
                    dateChange = $("#currentDate").text().replace(/-/gi, '.')
                    $.ajax({
                        url: "keywords.php",
                        type: "post",
                        data: {date : dateChange,
                                section : section},
                    }).done(function(data) {
                        $('#keywordTable').html(data);

                        var keyword = $("#keywordTable tr:eq(1) td:eq(1)")
                        var query = '<td onclick="ClickKeyword(this);" style="border: 2px solid red;">' + keyword.text() + '</td>'
                        ClickKeyword(query)
                        keyword.css("border", "2px solid red")
                    });
                }

                $("#politic").click(function(){ // 정치 버튼 클릭
                    inactivateButton(section)
                    section = '정치'
                    activateButton(section)
                    showKeywords();
                });

                $("#economy").click(function(){ // 경제 버튼 클릭
                    inactivateButton(section)
                    section = '경제'
                    activateButton(section)
                    showKeywords();
                });

                $("#social").click(function(){ // 사회 버튼 클릭
                    inactivateButton(section)
                    section = '사회'
                    activateButton(section)
                    showKeywords();
                });

                $("#lifeCulture").click(function(){ // 생활/문화 버튼 클릭
                    inactivateButton(section)
                    section = '생활/문화'
                    activateButton(section)
                    showKeywords();
                });

                $("#global").click(function(){ // 세계 버튼 클릭
                    inactivateButton(section)
                    section = '세계'
                    activateButton(section)
                    showKeywords();
                });

                $("#science").click(function(){ // 과학 버튼 클릭
                    inactivateButton(section)
                    section = 'IT/과학'
                    activateButton(section)
                    showKeywords();
                });
            });
        </script>
    </head>

    <body>
        <div id="date">
            <button id="yes">&lt</button>
            <p1 id="currentDate"></p1>
            <button id="tom">&gt</button>
            <input type="date" id="inputDate"/>
        </div>
        <br><br>

        <div class="main">
            <div class="grid category">
                <p>카테고리</p>
                <hr>
                <button id="politic">정치</button>
                <button id="economy">경제</button>
                <button id="social">사회</button>
                <button id="lifeCulture">생활/문화</button>
                <button id="global">세계</button>
                <button id="science">IT/과학</button>
            </div>
        
            <div class="grid result1">
                <div id="keywordTable" class="table-responsive"></div>
            </div>

            <div class="grid result2">
                <div id="relatedWordsTable" class="table-responsive"></div>
            </div>

            <div class="grid result3">
                <p>result 3</p>
                <p>키워드 관련 뉴스 등</p>
            </div>

        </div>
    </body>
</html>